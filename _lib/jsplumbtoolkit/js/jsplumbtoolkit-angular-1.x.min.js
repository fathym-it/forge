(function(){var a=function(){},b=function(a){return function(b,c,d,e){a.apply(a,arguments);var f=function(){if(b.group){var a=c[0].querySelector("[jtk-group-content]")||c[0];if(c[0]._jtkGroupProcessed!==!0&&c[0]._jtkGroupNodes){for(var d=0;d<c[0]._jtkGroupNodes.length;d++)a.appendChild(c[0]._jtkGroupNodes[d].el);delete c[0]._jtkGroupNodes}a.setAttribute("jtk-group-content","true"),c[0]._jtkGroupProcessed=!0}b.$emit("refresh",b.node||b.group)};b.$watch(null,f),b.$watchCollection(b.node?"node":"group",f)}},c=function(a,b){for(var c=a.$parent,d=a[b];null!=c&&null==d;)d=c[b],c=c.$parent;null!=d&&(a[b]=d)};angular.module("$jsPlumb",[]).factory("jsPlumbFactory",["$compile","jsPlumbService","$timeout",function(d,e,f){return{instance:function(a){return a=a||{},{restrict:"E",template:a.template||"<div class='jtk-angular-directive' style='height:100%;' ng-transclude></div>",transclude:!0,scope:{renderParams:"=",params:"=",data:"=",format:"=",jtkId:"@",surfaceId:"@",init:"="},replace:a.replace,controller:["$scope","$attrs",function(b,c){this.jtk=e.getToolkit(c.jtkId,b.params),this.data=b.data,b.toolkit=this.jtk;var d=this;b.$on("refresh",function(a,b){d.jtk.updateNode(b)}),a.controller&&a.controller.apply(this,arguments)}],controllerAs:a.controllerAs,link:function(b,c,g,h){var i=h.jtk,j=arguments,k=jsPlumb.extend({},b.renderParams);delete k.miniview;var l=g.format,m=0;jsPlumb.extend(k,{container:a.replace?c[0]:c[0].childNodes[0],templateRenderer:function(a,c,e,f){var g=b.$new();g[f]=c,g.toolkit=b.toolkit,g.surface=b.surface;var h=angular.element("<"+a+" "+f+'="'+f+'" toolkit="toolkit" surface="surface"></'+a+">");return d(h)(g),h},id:g.surfaceId}),k.id=k.id||jsPlumbToolkitUtil.uuid(),k.enhancedView=!1,k.connectionHandler=function(a,b){m++,f(b)},null!=g.miniview&&(k.miniview={container:g.miniview}),jsPlumbToolkit.ready(function(){b.surface=i.render(k),e.addSurface(k.id,b.surface),b.surface.bind("nodeAdded",function(a){if(a.node.group){var c=b.surface.getRenderedGroup(a.node.group.id);c&&c._jtkGroupProcessed!==!0&&(c._jtkGroupNodes=c._jtkGroupNodes||[],c._jtkGroupNodes.push(a))}}),b.toolkit.bind("nodeUpdated",function(){f(function(){b.$apply()})}),b.toolkit.bind("dataLoadStart",function(){m=0}),b.toolkit.bind("dataLoadEnd",function(){m>0&&f(b.surface.getJsPlumb().getGroupManager().refreshAllGroups),m=0}),a.link&&a.link.apply(this,j),b.data&&i.load({data:b.data,type:l}),b.init&&f(function(){b.init.apply(b,j)})}),a.link&&a.link.apply(this,arguments)}}},node:function(d){var e={};if(jsPlumb.extend(e,d||{}),e.restrict="E",e.scope=e.scope||{},e.scope.node="=",e.scope.toolkit="=",e.scope.surface="=",e.link=b(e.link||a),d.inherit)if(null==e.controller)e.controller=["$scope",function(a){for(var b=0;b<d.inherit.length;b++)c(a,d.inherit[b])}];else{if(null==e.controller.length)throw new TypeError("Controller spec must be in strict format to use inherit parameter with jsPlumb Angular integration");var f=e.controller.indexOf("$scope"),g=!1;f==-1&&(e.controller.unshift("$scope"),f=0,g=!0);var h=e.controller.pop();e.controller.push(function(){for(var a=0;a<d.inherit.length;a++)c(arguments[f],d.inherit[a]);h.apply(this,g?arguments.slice(1):arguments)})}return e},group:function(d){var e={};if(jsPlumb.extend(e,d||{}),e.restrict="E",e.scope=e.scope||{},e.scope.group="=",e.scope.toolkit="=",e.scope.surface="=",e.link=b(e.link||a),d.inherit)if(null==e.controller)e.controller=["$scope",function(a){for(var b=0;b<d.inherit.length;b++)c(a,d.inherit[b])}];else{if(null==e.controller.length)throw new TypeError("Controller spec must be in strict format to use inherit parameter with jsPlumb Angular integration");var f=e.controller.indexOf("$scope"),g=!1;f==-1&&(e.controller.unshift("$scope"),f=0,g=!0);var h=e.controller.pop();e.controller.push(function(){for(var a=0;a<d.inherit.length;a++)c(arguments[f],d.inherit[a]);h.apply(this,g?arguments.slice(1):arguments)})}return e},miniview:function(a){return{restrict:"AE",scope:{surfaceId:"@"},replace:!0,template:"<div></div>",link:function(a,b,c){var d=function(){e.addMiniview(c.surfaceId,{container:b})};a.$watch(null,d)}}}}}]).service("jsPlumbService",["$templateCache","$timeout",function(a,b){var c=new jsPlumbUtil.EventGenerator,d={},e=function(a,b){var e=jsPlumbToolkit.newInstance(b||{});return e._ngId=a,d[a]=e,c.fire("ready",{id:a,toolkit:e}),e},f={},g={},h={palette:function(a,b){a.registerDroppableNodes({droppables:b.selector(b.element),dragOptions:b.dragOptions,typeExtractor:b.typeExtractor,dataGenerator:b.dataGenerator,locationSetter:b.locationSetter,onDrop:b.onDrop})},miniview:function(a,c){var d=a.createMiniview({container:c.container});a.getToolkit().bind("dataLoadEnd",function(){b(d.invalidate)}),a.getToolkit().bind("nodeAdded",function(a){b(function(){d.invalidate(a.node.id)})})}},i=function(a,b,c){var d=f[a];d?c(d,b):(g[a]=g[a]||[],g[a].push([b,c]))};this.bind=function(a,b,d){c.bind(a,function(c){c.id==b&&d(c.toolkit,b,a)})},this.getToolkit=function(a,b){return a=a||jsPlumbToolkitUtil.uuid(),null!=d[a]?d[a]:e(a,b)},this.resetToolkit=function(a){var b=d[a];if(b){b.clear();var c=b.getRenderers();if(null!=c)for(var e in c)delete f[c[e]._ngId];delete d[a]}},this.addSurface=function(a,b){if(f[a]=b,b._ngId=a,g[a])for(var c=0;c<g[a].length;c++)try{g[a][c][1](b,g[a][c][0])}catch(a){"undefined"!=typeof console&&console.log("Cannot create component "+a)}delete g[a]},this.getSurface=function(a){return f[a]},this.addComponent=function(a,b,c){i(a,b,h[c])},this.addPalette=function(a,b){this.addComponent(a,b,"palette")},this.addMiniview=function(a,b){this.addComponent(a,b,"miniview")}}]).directive("jsplumbMiniview",["jsPlumbFactory",function(a){return a.miniview()}]).directive("jsplumbToolkit",["jsPlumbFactory",function(a){return a.instance()}]).directive("jsplumbPalette",["jsPlumbService","$timeout",function(a,b){return{restrict:"AE",scope:{typeExtractor:"=",generator:"=",dragOptions:"=",locationSetter:"=",onDrop:"="},link:function(c,d,e){b(function(){var b=a.getSurface(e.surfaceId);b&&(c.droppablesHandler=b.registerDroppableNodes({source:d[0],selector:e.selector,dragOptions:c.dragOptions||{zIndex:5e4,cursor:"move",clone:!0},typeExtractor:c.typeExtractor,dataGenerator:c.generator,locationSetter:c.locationSetter,onDrop:c.onDrop}))})}}}])}).call("undefined"!=typeof window?window:this);